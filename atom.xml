<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[Grayon's Blog]]></title>
  <subtitle><![CDATA[Nice to meet you]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://laa.pw/"/>
  <updated>2015-11-12T03:57:41.000Z</updated>
  <id>http://laa.pw/</id>
  
  <author>
    <name><![CDATA[Grayon]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[UINavigationController的ViewControllers管理]]></title>
    <link href="http://laa.pw/2015/11/01/NavigationController-viewControllers-Management.html"/>
    <id>http://laa.pw/2015/11/01/NavigationController-viewControllers-Management.html</id>
    <published>2015-11-01T12:39:37.000Z</published>
    <updated>2015-11-12T03:57:41.000Z</updated>
    <content type="html"><![CDATA[<h1 id="问题描述">问题描述</h1><p>在使用<strong>UINavigationController</strong>时，使用简单的<strong>push</strong>（现在是show）、<strong>pop</strong>操作就可以实现页面的层次管理，iOS的导航控制器也提供了很好的动画效果和手势控制，带来了非常优秀的用户体验。</p>
<p>可是<strong>UINavigationController</strong>是使用栈来管理的，在使用时我们难免会遇到特殊的需求，使用简单的<strong>push</strong>、<strong>pop</strong>不能满足，这时候就需要我们自己手动来管理<strong>UINavigationController</strong>的<strong>viewControllers</strong>了。</p>
<h1 id="应用实例">应用实例</h1><p>在使用<strong>微信</strong>或者<strong>qq</strong>时，你可能会发现，<strong>微信</strong>的<strong>NavigationController</strong>的竟然可以在子视图之间随意跳转。</p>
<p>比如打开首页右上角的扫一扫功能，扫描一个网址二维码，可以看到一个push动画进入了一个<strong>WebviewController</strong>,这时候不管你用左上角的返回键还是使用手势滑动返回，你都会发现你直接回到了首页，中间的扫一扫界面去哪了？</p>
<p>还有打开联系人界面，点击查看联系人详情，一切都很正常，可是再联系人详情页面点击发消息，再试试返回键或者返回手势，发现了吗，这看起来好像从一个<strong>NavigationController</strong>的子页面push到了另一个<strong>NavigationController</strong>的子页面，这看起来应该是不能被实现的，<br>这不符合<strong>NavigationController</strong>的页面管理方式。</p>
<h1 id="研究实现">研究实现</h1><p>经过对<strong>微信</strong>的研究，发现原本我对微信的结构理解是错误的，原本认为微信的主界面是使用一个<strong>UITabBarViewController</strong>管理着四个<strong>NavigationController</strong>来实现的，可是现在发现，他应该是使用了一个统一的<strong>NavigationController</strong>管理一个<strong>TabBarViewController</strong>，其下有四个子<strong>ViewController</strong>。<br>通过监听<strong>selectedIndex</strong>来改变<strong>navigationItem</strong>的<strong>title</strong>就可以了。</p>
<p>通过这样管理就可以在子<strong>ViewController</strong>之间跳转了，可是这样还是不能实现微信的效果，因为从view22 push到view12再返回时view22从导航控制器的栈里消失了。</p>
<p>那我们是不是可以先pop出当前页面再push</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="built_in">UIViewController</span> *vc = [[<span class="built_in">UIStoryboard</span> storyboardWithName:<span class="string">@"Main"</span> bundle:[<span class="built_in">NSBundle</span> mainBundle]] instantiateViewControllerWithIdentifier:<span class="string">@"view12"</span>];</span><br><span class="line"><span class="built_in">UITabBarController</span> *tb = <span class="keyword">self</span><span class="variable">.navigationController</span><span class="variable">.viewControllers</span>[<span class="number">0</span>];<span class="comment">//取得栈中tabBarController</span></span><br><span class="line">[tb setSelectedIndex:<span class="number">0</span>]; <span class="comment">//改变tabBar的selectedIndex</span></span><br><span class="line">[<span class="keyword">self</span><span class="variable">.navigationController</span> popToRootViewControllerAnimated:<span class="literal">NO</span>];</span><br><span class="line">[<span class="keyword">self</span> showViewController:vc sender:<span class="keyword">self</span>];</span><br></pre></td></tr></table></figure>
<p>尝试后发现不能正常显示了，哪里出错了，思考了下发现在pop后self已经不在navigationController的栈中了，所以使用show会出错，修改下就好了。</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="built_in">UIViewController</span> *vc = [[<span class="built_in">UIStoryboard</span> storyboardWithName:<span class="string">@"Main"</span> bundle:[<span class="built_in">NSBundle</span> mainBundle]] instantiateViewControllerWithIdentifier:<span class="string">@"view12"</span>];</span><br><span class="line"><span class="built_in">UITabBarController</span> *tb = <span class="keyword">self</span><span class="variable">.navigationController</span><span class="variable">.viewControllers</span>[<span class="number">0</span>];<span class="comment">//取得栈中tabBarController</span></span><br><span class="line">[tb setSelectedIndex:<span class="number">0</span>]; <span class="comment">//改变tabBar的selectedIndex</span></span><br><span class="line">[<span class="keyword">self</span><span class="variable">.navigationController</span> popToRootViewControllerAnimated:<span class="literal">NO</span>];</span><br><span class="line">[tb showViewController:vc sender:<span class="keyword">self</span>];</span><br></pre></td></tr></table></figure>
<p>但是这里还是有一个问题，虽然我们取消了动画但是我们还是能察觉到当前的view变化了。我想要一个完美的效果，不会让用户察觉到任何的问题，给用户最好的体验。这时候就必需要自己手动控制<strong>NavigationController</strong>的stack了，使用setViewControllers来管理。</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="built_in">UIViewController</span> *vc = [[<span class="built_in">UIStoryboard</span> storyboardWithName:<span class="string">@"Main"</span> bundle:[<span class="built_in">NSBundle</span> mainBundle]] instantiateViewControllerWithIdentifier:<span class="string">@"view12"</span>];</span><br><span class="line"><span class="built_in">UITabBarController</span> *tb = <span class="keyword">self</span><span class="variable">.navigationController</span><span class="variable">.viewControllers</span>[<span class="number">0</span>];</span><br><span class="line">[tb setSelectedIndex:<span class="number">0</span>];</span><br><span class="line"><span class="built_in">NSMutableArray</span> *arr = [[<span class="built_in">NSMutableArray</span> alloc] initWithArray:<span class="keyword">self</span><span class="variable">.navigationController</span><span class="variable">.viewControllers</span>];</span><br><span class="line">[arr removeLastObject];</span><br><span class="line">[arr addObject:vc];</span><br><span class="line">[<span class="keyword">self</span><span class="variable">.navigationController</span> setViewControllers:arr animated:<span class="literal">YES</span>];</span><br></pre></td></tr></table></figure>
<h1 id="效果演示">效果演示</h1><p><img src="/uploads/navigationcontroller.gif" alt=""> </p>
<h1 id="示例源码">示例源码</h1><p><a href="https://github.com/Grayon/WechatNavigationController" target="_blank" rel="external">WechatNavigationController</a> </p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="问题描述">问题描述</h1><p>在使用<strong>UINavigationController</strong>时，使用简单的<strong>push</strong>（现在是show）、<strong>pop</strong>操作就可以实现页面的层次管理]]>
    </summary>
    
      <category term="UINavigationController" scheme="http://laa.pw/tags/UINavigationController/"/>
    
      <category term="iOS" scheme="http://laa.pw/tags/iOS/"/>
    
      <category term="viewControllers" scheme="http://laa.pw/tags/viewControllers/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[OS X 10.11 使用pod提示command not find]]></title>
    <link href="http://laa.pw/2015/10/29/OS-X-10-11-use-pod-command-not-find.html"/>
    <id>http://laa.pw/2015/10/29/OS-X-10-11-use-pod-command-not-find.html</id>
    <published>2015-10-29T09:09:38.000Z</published>
    <updated>2015-10-29T09:24:51.000Z</updated>
    <content type="html"><![CDATA[<p>今天在Github上下载了写源码，准备编译测试，因为它使用了Cocoapods管理第三方库，所以先要用pod命令下载好第三方库。</p>
<p>我切换到相应目录使用pod install命令，居然提示command not find，pod命令直接失踪了，原来装的好好的Cocoapods呢，因为最近刚刚升级OS X 10.11所以可能和升级系统有关，应该再次安装就好了。</p>
<p>使用<br><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">sudo gem <span class="keyword">install</span> Cocoapods</span><br></pre></td></tr></table></figure></p>
<p>命令安装，这里又提示出错：</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">Error fetching <span class="string">http:</span><span class="comment">//ruby.taobao.org/:</span></span><br><span class="line">	bad response Not Found <span class="number">404</span> (<span class="string">http:</span><span class="comment">//ruby.taobao.org/specs.4.8.gz)</span></span><br></pre></td></tr></table></figure>
<p>404错误淘宝的镜像源出什么问题了？<br>打开淘宝源官网有说明，已停用http现在改用https。<br>使用命令：</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">gem sources --<span class="built_in">add</span> http<span class="variable">s:</span>//<span class="keyword">ruby</span>.taobao.org/ --<span class="built_in">remove</span> http<span class="variable">s:</span>//rubygems.org/</span><br></pre></td></tr></table></figure>
<p>切换成https的源即可。</p>
<p>再次使用<br><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">sudo gem <span class="keyword">install</span> Cocoapods</span><br></pre></td></tr></table></figure></p>
<p> 命令安装。</p>
<p>居然又出错：</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="constant">ERROR:</span>  <span class="constant">While </span>executing gem ... (<span class="constant">Errno:</span><span class="symbol">:EPERM</span>)</span><br><span class="line">    <span class="constant">Operation </span><span class="keyword">not</span> permitted - <span class="regexp">/usr/bin</span><span class="regexp">/pod</span></span><br></pre></td></tr></table></figure>
<p>提示是操作不允许，现在可是root权限执行命令，怎么会提示权限问题呢，查阅相关资料了解到：</p>
<p>OS X El Capitan中，在内核下引入了Rootless机制，以下路径：</p>
<figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line">/System</span><br><span class="line">/bin</span><br><span class="line">/sbin</span><br><span class="line">/usr <span class="list">(<span class="keyword">except</span> /usr/local)</span></span><br></pre></td></tr></table></figure>
<p>均属于Rootless范围，即使root用户无法对此目录有写和执行权限，只有Apple以及Apple授权签名的软件（包括命令行工具）可以修改此目录。</p>
<p>所以想要安装Cocoapods还要关闭掉Rootless吗，这种方式是可行的，但是我当然不推荐。</p>
<p>更改应用安装目录就可以了。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">sudo gem <span class="operator"><span class="keyword">install</span> -<span class="keyword">n</span> /usr/<span class="keyword">local</span>/<span class="keyword">bin</span> cocoapods</span></span><br></pre></td></tr></table></figure>
<p>至此再使用pod命令就不会有任何问题了。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>今天在Github上下载了写源码，准备编译测试，因为它使用了Cocoapods管理第三方库，所以先要用pod命令下载好第三方库。</p>
<p>我切换到相应目录使用pod install命令，居然提示command not find，pod命令直接失踪了，原来装的好好的Co]]>
    </summary>
    
      <category term="Cocoapods" scheme="http://laa.pw/tags/Cocoapods/"/>
    
      <category term="OS X" scheme="http://laa.pw/tags/OS-X/"/>
    
      <category term="iOS" scheme="http://laa.pw/tags/iOS/"/>
    
  </entry>
  
</feed>
